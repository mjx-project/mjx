syntax = "proto3";

package mjproto;

service Agent {
  rpc TakeAction (Observation) returns (Action) {}
}

enum Wind {
  WIND_EAST = 0;
  WIND_SOUTH = 1;
  WIND_WEST = 2;
  WIND_NORTH = 3;
}

enum ActionType {
    ACTION_TYPE_DRAW = 0;
    ACTION_TYPE_DRAW_AFTER_KAN = 1;
    ACTION_TYPE_DISCARD = 2;
    ACTION_TYPE_RIICHI_AND_DISCARD = 3;
    ACTION_TYPE_TSUMO = 4;
    ACTION_TYPE_TSUMO_AFTER_KAN = 5;
    ACTION_TYPE_RON = 6;
    ACTION_TYPE_RON_AFTER_KAN = 7;
    ACTION_TYPE_CHI = 8;
    ACTION_TYPE_PON = 9;
    ACTION_TYPE_KAN_CLOSED = 10;
    ACTION_TYPE_KAN_OPENED = 11;
    ACTION_TYPE_KAN_ADDED = 12;
    ACTION_TYPE_KYUSYU = 13;
}

message Score {
  uint32 round = 1;
  uint32 honba = 2;
  uint32 riichi = 3;
  repeated uint32 ten = 4;
}

message TakenAction {
  uint32 who = 1;
  uint32 type = 2;  // draw, discard, riichi_and_discard, chi, pon, kan_opened, kan_closed, kan_added, tsumo ,ron
  uint32 draw = 3;
  uint32 discard = 4;
  bool discard_drawn_tile= 5;  // discard the drawn tile
  uint32 open = 6;
}

message ActionHistory {
  repeated TakenAction taken_actions = 1;
}

message InitialHand {
  repeated uint32 tiles = 1;
}

message PossibleAction {
  uint32 type = 1;
  uint32 open = 2;
  repeated uint32 discard_candidates = 3;
}

// Similar to Tenhou's mjlog format. Initial hand and action sequence are sent to each player.
// However, different from Tenhou, each observation request is stateless.
// Each request has enough information to make decisions.
message Observation {
  uint32 game_id = 1;
  Score score = 2;  // public info
  ActionHistory action_history = 3;  // public info
  uint32 who = 4;
  InitialHand initial_hand = 5;  // private info
  repeated PossibleAction possible_actions = 6;
}

message State {
  uint32 game_id = 1;
  Score score = 2;
  repeated int32 wall = 3;
  ActionHistory action_history = 4;
  repeated InitialHand initial_hands = 5;
  repeated PossibleAction possible_actions = 6;
}

message Action {  // corresponds to mj::Action in cpp
  uint32 game_id = 1;
  uint32 who = 2;
  uint32 type = 3;
  bool yes = 4; // riichi_and_discard, tsumo, ron and kyusyu (九種九牌)
  uint32 discard = 5;  // discard, riichi_and_discard, chi and pon
  uint32 open = 6;  // chi, pon, kan_opened, kan_closed, and kan_added
}
